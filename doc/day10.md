# 第10日：APIテストの具体的な手法

本日は、画面（UI）を介さずに、システム間の接点である**API（Application Programming Interface）**を直接検証する手法について学びます。テスターとして、バックエンドの挙動を直接確認できるようになることで、より深い不具合の検出が可能になります。

---

## 1. APIテストとは

APIテストは、主に**結合テスト（IT）**や**システムテスト（ST）**のフェーズで行われる、インターフェース（データの受け渡し口）の正しさを確認するテストです。
**テスターの視点：** 画面上のボタン操作ではなく、「リクエスト（要求）」を送り、「レスポンス（応答）」が仕様通りかを検証します。
**目的：** 画面が未完成の状態でもロジックを検証でき、UIテストでは再現しにくい「データの境界値」や「セキュリティの脆弱性」を効率的に発見することです。

## 2. APIテストの主要な確認項目

APIをテストする際は、以下の3点をセットで確認します。

| 確認項目 | 内容 | 期待値の例 |
| :--- | :--- | :--- |
| **HTTPステータスコード** | リクエストの結果を数字で表したもの。 | 成功なら **200 OK**、入力不備なら **400**、サーバーエラーなら **500**。 |
| **レスポンスボディ (JSON)** | 返ってくるデータの中身（タイトル、ISBN等）。 | 検索結果に正しい書籍名が含まれているか。 |
| **データベース（DB）の状態** | API実行後のデータの変化。 | 貸出APIを叩いた後、`loan` テーブルにレコードが増えているか。 |

## 3. 図書管理システムを用いた具体的なテスト手法

基本仕様書とデータベース設計書に基づき、具体的なケースを想定します。

## ① 検索APIの検証（機能適合性とセキュリティ）

**正常系：** 書籍タイトルの一部をパラメータとして送り、該当する書籍データが正しいJSON形式で返ってくるかを確認します。
**異常系：** 検索窓に `'`（シングルクォート）などの特殊文字を送り、**500エラー（Internal Server Error）**が発生せずに適切に処理されるかを確認します。

## ② 貸出実行APIの検証（境界値とデータ整合性）

**境界値テスト：** すでに5冊借りているユーザーIDで貸出APIを呼び出し、6冊目がエラー（400等）になるか確認します。
**整合性チェック：** 貸出成功後、DBの `book` テーブルの `stock_count` が正しく1減っているか、SQLを発行して裏取りを行います。

## ③ 権限チェック（セキュリティ）

**未ログインアクセス：** ログインせずに書籍登録API（管理者用）を直接叩いた際、ログイン画面へリダイレクトされるか、または **403 Forbidden** エラーが返るかを確認します。

## 4. APIテストにおける「品質特性」の視点

ISO/IEC 25010の品質特性をAPIテストに当てはめると、以下のようになります。

**機能正確性：** 期待したデータが1件の漏れもなく返ってくるか。
**信頼性：** 不正な形式のデータを送ってもシステムがクラッシュせず、エラーメッセージを返せるか。
**機密性（セキュリティ）：** 他人の貸出履歴を取得しようとした際に、適切に拒否されるか。

## 5. テスターに求められる動き

APIテストにおいても、第1日に学んだ**「ユーザーならどうするか」「仕様の行間を読む」**というマインドセットは共通です。

1. **エビデンスの取得：** リクエスト内容とレスポンス内容をテキストやスクリーンショットで記録します。
2. **再現手順の明確化：** APIテストでバグを見つけた際は、使用したエンドポイントやパラメータ、ヘッダー情報をバグ票に明記し、開発者が即座に再現できるように報告します。

---

## まとめ

APIテストを習得することで、UIという「表面」だけでなく、システムの「中身（ロジックやデータ）」を直接検証できるようになります。これは、将来的にテスト自動化に取り組む際の重要な基礎知識（テストエンジニアリング）となります。
画面を触る前に、「裏側のデータはどう動くべきか？」を常に意識するプロのテスターを目指しましょう。
