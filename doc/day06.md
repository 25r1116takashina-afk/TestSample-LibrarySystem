# 第6日：テスト設計の応用「ディシジョンテーブル」

本日は、単一の入力値だけでなく、複数の条件が組み合わさった複雑なビジネスルールを攻略する技法を学びます。また、作成したテストケースを「誰が読んでも実行できる」形に整えるための管理手法についても解説します。

## 複雑な条件組み合わせの整理（デシジョンテーブル）

「AかつBのときは実行、ただしCの場合は除外」といった複雑な仕様を、頭の中だけで整理すると必ず漏れが生じます。これを論理的に整理するツールが **デシジョンテーブル（決定表）** です。

| 条件 (Conditions) | ケース1 | ケース2 | ケース3 | ケース4 |
| --- | --- | --- | --- | --- |
| 会員ランクが「ゴールド」 | Y | Y | N | N |
| クーポンを利用する | Y | N | Y | N |
| **動作 (Actions)** |  |  |  |  |
| **割引率を20%にする** | **◯** |  |  |  |
| **割引率を10%にする** |  | **◯** | **◯** |  |
| **割引なし** |  |  |  | **◯** |

> **Point:** デシジョンテーブルを作ることで、仕様書の「書き漏れ」や「条件の矛盾」を実装前に発見することができます。

## デシジョンテーブルと境界値分析

デシジョンテーブルと境界値分析をどう組み合わせるかは、テスト設計の効率と品質を左右する非常に鋭い視点です。

結論から言うと、**「論理構造はデシジョンテーブルで整理し、具体的な値は境界値分析で選定する」**という、**補完関係**として扱うのがベストです。

---

### 1. デシジョンテーブルに境界値分析を加えるとどうなるか？

デシジョンテーブルに境界値を組み込むと、テーブルの「条件（Conditions）」列がより具体的になります。

例えば、「5,000円以上で割引」という条件がある場合、デシジョンテーブル上では単に「Y / N」で表しますが、テストを実行する際は以下の値を流し込むことになります。

* **境界値の適用例：**
* **条件（5,000円以上）：** 
  * 4,999円（Nの代表）
  * 5,000円（Yの代表）
  * 5,001円（Yの代表）

このように組み合わせることで、**「条件の組み合わせ漏れ（論理）」**と**「数値の判定ミス（仕様）」**の両方を一度に叩くことができます。

---

### 2. 通常、これらは別にすべきか？

現場の判断によりますが、基本的には **「設計フェーズでは分けるが、テストケース作成時にハイブリッド化する」** のが一般的です。

#### 理由別のメリット・デメリット
- ※ハイブリッドは『分けて管理する場合』になります。

| 観点 | 分けて管理する場合（推奨） | 統合して管理する場合 |
| --- | --- | --- |
| **可読性** | テーブルがシンプルで、論理構造が理解しやすい。 | テーブルが巨大化し、一目で全体を把握しにくい。 |
| **メンテナンス** | 割引率などのロジック変更に強い。 | ロジックが変わるたびに大量のケース修正が必要。 |
| **テストケース数** | 必要最小限の組み合わせで済む。 | 条件数 × 境界値数で、ケース数が爆発（組合せ爆発）しやすい。 |

> **アドバイス：**
> すべての条件組み合わせに対して境界値を全パターン適用すると、テスト回数が膨大になります。
> 実際には、**「デシジョンテーブルで導き出した有効な1パターンに対し、その中の重要項目だけ境界値（有効1つ、無効1つなど）を割り当てる」**というハイブリッドな手法が効率的です。

---

### 3. 実務での使い分けイメージ

実務では **「同等分割でグループを分け、デシジョンテーブルで組み合わせを整理し、境界値分析でピンポイントに狙い撃つ」** という流れが良いテストケースの作成の方法となります。

#### 3つを組み合わせたテスト設計フロー

実際の現場では、以下のような手順でテストケースを作成します。
##### 前提条件
- 条件：「購入金額」
  - `0〜4999円`（割引なし）
  - `5000円以上`（割引あり）
- 条件：「会員」
  - プラチナ会員
  - ゴールド会員
  - シルバー会員
  - 一般会員(会員無し)
- 条件：「クーポン」
  - 10%割引
  - クーポン無し

##### ステップ①：同等分割
- 「購入金額」は`0〜4999円`（割引なしグループ）と`5000円以上`（割引ありグループ）に分割します。
- 「会員」や「クーポン」はその条件をそのまま使います。

##### ステップ②：デシジョンテーブル

分割した各グループを、他の条件（会員・クーポン）と組み合わせて、どの「ルール（列）」をテストすべきか決定します。

##### ステップ③：境界値分析（値の選定）

テーブルで決まった「ルール」を実際にテストする際、分割したグループの端っこ（`4999円`、`5000円`）をテストデータとして採用します。

---
#### まとめ
1. **同等分割**で、無限にあるデータを『同じ性質のチーム』にまとめます。
2. **デシジョンテーブル**で、その『チーム同士』の複雑な相関図を描きます。
3. **境界値分析**で、チームの境界線にエラーが潜んでいないかチェックします。
- この3段階を踏むことで、**最小限の回数で、最大限のバグを見つける**ことができます。
